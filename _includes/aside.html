<div class="posts-tree">
  {% comment %} ÈááÁî®Êõ¥Á®≥ÂÆöÁöÑ site.categories ÈÅçÂéÜ {% endcomment %} {% for
  category in site.categories %}
  <div class="category-group">
    <div class="category-title" aria-expanded="false">
      <span class="category-toggle">‚ñ∂</span>
      <span style="font-size: 14px"
        >üìÅ {{ category | first }} ({{ category | last | size }} ÁØá)</span
      >
    </div>
    <ul class="post-list is-collapsed">
      {% for post in category.last %}
      <li class="post-item" data-title="{{ post.title }}">
        <a href="{{ post.url | relative_url }}?active={{ post.title  }}"
          >{{ post.title }}</a
        >
      </li>
      {% endfor %}
    </ul>
  </div>
  {% endfor %}
</div>

<script>
  (function () {
    var params = new URLSearchParams(window.location.search);
    var active = params.get("active");
    if (!active) return;
    var items = document.querySelectorAll(".posts-tree .post-item");
    items.forEach(function (li) {
      if (li.getAttribute("data-title") === active) {
        li.classList.add("post-active");
        var group = li.closest(".category-group");
        if (group) {
          var title = group.querySelector(".category-title");
          var list = group.querySelector(".post-list");
          if (title && list) {
            title.setAttribute("aria-expanded", "true");
            list.classList.remove("is-collapsed");
            var icon = title.querySelector(".category-toggle");
            if (icon) icon.textContent = "‚ñº";
          }
        }
      }
    });
  })();
</script>

<script>
  (function () {
    var tree = document.querySelector(".posts-tree");
    if (!tree) return;
    tree.addEventListener("click", function (e) {
      var title = e.target.closest(".category-title");
      if (!title) return;
      var list = title.nextElementSibling;
      if (!list) return;
      var expanded = title.getAttribute("aria-expanded") === "true";
      var nextExpanded = !expanded;
      title.setAttribute("aria-expanded", nextExpanded ? "true" : "false");
      list.classList.toggle("is-collapsed", !nextExpanded);
      // toggle sign
      var icon = title.querySelector(".category-toggle");
      if (icon) {
        icon.textContent = nextExpanded ? "‚ñº" : "‚ñ∂";
      }
    });
  })();
</script>
